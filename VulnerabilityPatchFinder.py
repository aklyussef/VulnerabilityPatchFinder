import sys
from IOHelper import IOHelper
from GitHelper import GitHelper


def main():

    if (len(sys.argv) != 2):
        print("USAGE: {} path/to/git/repo/file/toscan".format(sys.argv[0].split('/')[-1]))
        return

    IOhelper = IOHelper()

    repoList = IOhelper.getreposfromFile()
    IOhelper.createOutputDirectory()
    IOhelper.writeOutputHeader()

    for repoURL in repoList:
        print("Scanning repo {}".format(repoURL))
        gitHelper = GitHelper(repoURL)
        gitHelper.cloneRepo(IOhelper.createRepoDirectory(repoURL))
        IOhelper.writeRepoFinds(gitHelper.findFixCommits())
    IOhelper.free_resources()


if __name__ == '__main__':
    main()