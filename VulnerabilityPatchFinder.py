import sys
from IOHelper import IOHelper
from GitHelper import GitHelper


def main():
    # if (len(sys.argv) != 2):
    #     print("USAGE: {} http://github.com/repoURL".format(sys.argv[0].split('/')[-1]))
    #     return
    testURL = r'https://github.com/aklyussef/VulnerableRepoTest.git'
    repoURL = testURL
    IOhelper = IOHelper()
    IOhelper.createOutputDirectory()
    IOhelper.writeOutputHeader()

    # get repoURL list from file in sys.argv[1]
    # Check if is valid URL in file reader function
    # For each URL in file do the following
    print("Scanning repo {}".format(repoURL))
    gitHelper = GitHelper(repoURL)
    gitHelper.cloneRepo(IOhelper.createRepoDirectory(repoURL))
    IOhelper.writeRepoFinds(gitHelper.findFixCommits())
    # Finally free resources
    IOhelper.free_resources()


if __name__ == '__main__':
    main()